# README #

## Introduction ##

XGC_VIS provides tools to extract, track, and visualize topological blobs in XGC simulations.  

A set of tools are provided: 

* "Core": the core data analysis tool that can coule with the simulation via ADIOS in situ
* "GUI": the standalone Qt/OpenGL based GUI for visualizing analysis results in post-hoc

## Prerequisites ##

### Prerequisites for "Core" ###

* [CMake](http://www.cmake.org/) (version >= 3.1.3)
* ADIOS (tested with version 1.11.0)
* MPI (tested with mpich-3.2)

### Prerequisites for "GUI"

* [Qt4](http://www.qt.io/) (preferable 4.8.6)

## Build Guidelines ##

Please first clone the code from GitHub: 

`$ git clone git@github.com:CODARcode/xgc_vis.git`

Create a build directory for cmake: 

`$ mkdir build && cd build`

### Build "Core" Only ###

Replace "$your_adios_installation" with your ADIOS installation path: 

``` shell
$ CC=mpicc CXX=mpicxx ADIOS_DIR=$your_adios_installation cmake ..
$ make
```

### Build "GUI" Only

Relace "$your_qmake_executable" with your Qt4's qmake location: 

```shell
$ cmake .. -DXGCVIS_BUILD_GUI=ON -DXGCVIS_BUILD_CORE=OFF -DQT_QMAKE_EXECUTABLE=$your_qmake_excutable
$ make
```

### Build both "Core" and "GUI"

```shell
$ CC=mpicc CXX=mpicxx ADIOS_DIR=$your_adios_installation cmake .. -DXGCVIS_BUILD_GUI=ON -DQT_QMAKE_EXECUTABLE=$your_qmake_excutable
$ make
```

## Run Test

Please make the following files availabe in your build directory: 

- xgc.mesh.bp (XGC triangular mesh)
- xgc.3d.bp (XGC dpot data)

### Run "Core"

```shell
$ ./core/xgcvis_core
reading mesh...
nNodes=20694, nTriangles=41087
reading data...
starting analysis..
building contour tree over 3D...
built contour tree over 3D.
dumping results..
```

As a result, the "core" will generate the following files: 

- xgc.mesh.json (XGC triangular mesh in JSON format)
- xgc.branches.json (the contour trees in JSON format)
- xgc.labels.bin (the segmentation labels in binary format)

You may further reduce the sizes of the output by using gzip.  For xgc.labels.bin, you can typically get 40x reduction.  For xgc.branches.json you can get 4x reduction.  

### Run "GUI"

```shell
$ ./gui/xgcvis_gui
```

The "GUI" will load the three files that are generated by "Core", and start an interactive OpenGL window.  You can use mouse pointer to pan and zoom.  You can also switch slices with left and right arrow keys.  


## Contact ##

* [Hanqi Guo](http://www.mcs.anl.gov/~hguo/), [hguo@anl.gov](mailto:hguo@anl.gov)
* Tom Peterka, [tpeterka@mcs.anl.gov](mailto:tpeterka@mcs.anl.gov)
